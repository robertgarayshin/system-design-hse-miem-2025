# Домашнее задание №2: Интеграции - Room With A View

## 1. Список основных сервисов

### Обязательные:

- **Auth Service (Сервис авторизации и аутентификации)**  
  Регистрация, вход, авторизация сессий, роли пользователей  
  Хранение пользовательских данных, кроме платежных (как вариант - можно вывести в отдельный сервис Users/IAM)

- **Reservation Service (Сервис бронирования)**  
  Создание, удаление, просмотр бронирований, проверка доступности  
  Управление бронированиями (продление, изменение, дополнение данных)

- **Room Management Service (RMS)**  
  Управление статусом номеров (свободен, занят, требуется уборка и пр.)  
  Редактирование информации о номерах, подсчет количества занятых/свободных номеров   

- **Housekeeping Service (Сервис для персонала)**  
  Формирование и получение заданий на уборку, отметки о выполнении  
  Внесение комментариев по процессу выполнения работ

- **Payment Gateway**  
  Платежный шлюз/адаптер для взаимодействия с существующей системой  
  Хранение и обработка информации о платежах пользователей

- **Notification Service**  
  Асинхронная отправка push, email, SMS уведомлений

- **API Gateway**  
  Агрегация запросов от клиентов, работа с UI (предполагаем решение BFF - backend for frontend)

### Необязательные / Желательные:

- **Smart Devices Integration Service**  
  Интеграция с умными замками и устройствами уборки  
  Возможность интеграции с иными умными устройствами от компании-заказчика

- **Recommendation Service**  
  AI-based сервис рекомендаций на основе истории поиска, просмотров и бронирований

- **Feedback Service**  
  Отзывы о номерах, отелях, системе и процессе бронирования  
  Отзывы о работе персонала

- **Callcenter API**  
  API для сотрудников колл-центра. Возможно использовать "коробочное решение"

- **Analytics Service**  
  Сервис для сбора и анализа различных метрик, например бронирования/месяц, прибыль/год, выручка/день и тд.

---

## 2. Взаимодействие между сервисами

### Виды интеграции:

| Источник        | Цель                      | Тип взаимодействия  | Обоснование |
|----------------|---------------------------|---------------------|-------------|
| Auth Service    | Все остальные сервисы      | **Синхронное (REST/gRPC)** | Необходим для верификации токена |
| Reservation ↔ Room Management | Проверка и обновление статуса комнат | **Синхронное** | Актуальность данных критична |
| Housekeeping Service ↔ RMS | Получение заданий | **Синхронное** | Уборка и бронирование должны быть согласованы |
| Web/Mobile ↔ Notification Service | Уведомления | **Асинхронное (WebSocket / Kafka)** | Push-уведомления не критичны к задержкам |
| Smart Devices Integration ↔ RMS | Обновление состояния комнаты | **Асинхронное (gRPC Streaming)** | Легкий протокол, отказоустойчивость |
| Recommendation Service ↔ Reservation/Feedback | История бронирований и отзывов | **Асинхронное (ETL / pub-sub)** | Нет жёстких требований по времени отклика |
| Callcenter API ↔ Reservation/Auth | Управление бронированиями | **Синхронное** | Для call-центра важен быстрый отклик |

---

## 3. Способ взаимодействия между сервисами

### Выбор: **gRPC + Kafka + REST**

- **gRPC** — для внутренних высокоэффективных запросов между core-сервисами (Auth, RMS, Reservation)
- **REST** — для взаимодействия с внешними системами (мобильное приложение, колл-центр, веб-клиенты)
- **Kafka / MQTT** — для асинхронных событий: нотификации, интеграция с умными устройствами, логгирование и аналитика

**Обоснование:**

- gRPC обеспечивает высокую производительность и строгую типизацию.
- REST проще реализовать в интерфейсе клиента.
- Kafka / MQTT обеспечивают отказоустойчивость и масштабируемость при асинхронной доставке.

---

## 4. HLD (High-Level Design)

```
                  +------------------------+
                  |     Web/Mobile App     |
                  +----------+-------------+
                             |
                      REST / WebSocket
                             ↓
                 +-----------+-----------+
                 |   API Gateway / BFF   |
                 +-----------+-----------+
                             ↓
     ↑-----------+-----------+-----------+-----------↑
     |           |                       |           |
     ↓           ↓                       ↓           ↓
+----------+ +-------------+     +----------------+ +----------------+
|   Auth   | | Reservation |     | Room Mgmt (RMS)| | Notification    |
| Service  | |  Service    |<--->|  Service       | |  Service        |
+----------+ +-------------+     +----------------+ +----------------+
     |             |                     ↑
     ↓             ↓                     |
+------------------------+         +-----------+
|     Payment Gateway    |         |Housekeeping|
+------------------------+         |   Service  |
                                   +-----------+
                                         ↑
                                         ↓
                        +-------------------------------+
                        | Smart Devices Integration Svc |
                        +-------------------------------+

Optional:
 - Recommendation Service (подключается к Reservation & Feedback)
 - Feedback Service (получает данные от клиентов)
 - Callcenter API (взаимодействует со всеми сервисами через SUPPORT ручки)
 - Analytics Service (подкдючается к Reservation, к другим опционально)
```

---

## 5. Заключение

В данном случае лучше всего будет использовать систему с микросервисной архитектурой с применениями разныз подходов взаимодействия (синхронный и асинхронный), которые обеспечивающих отказоустойчивость, гибкость и горизонтальную масштабируемость системы. Кроме основных требований, были учтены особенности "умных" устройств, высокая нагрузка в сезон, требования к быстрому отклику и безопасности пользовательских и платежных данных по 152ФЗ.
