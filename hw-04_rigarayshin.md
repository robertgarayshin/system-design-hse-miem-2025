# Домашнее задание №4: Дополнение High Level Design - Room With A View

## 1. Введение

Цель задания - дополнить High Level Design системы новыми компонентами, которые необходимы для устойчивой, безопасной и масштабируемой работы в условиях прода. Компоненты делятся на **обязательные (MUST)** и **рекомендуемые (SHOULD)**. Учитываются технологические и регуляторные требования (такие как 152-ФЗ).

## 2. Обязательные компоненты (MUST)

| Компонент           | Обоснование                                                                 | Реализация                              |
|---------------------|------------------------------------------------------------------------------|--------------------------------------------------------|
| Load Balancer       | Распределение трафика между инстансами сервисов. Обязателен для масштабирования. | Yandex Load Balancer / Nginx                          |
| CDN                 | Быстрая доставка изображений комнат и другой статики                        | Cloudflare + S3                                        |
| IdP                 | Централизованная авторизация для разных ролей                               | Keycloak (OAuth 2.0 / OpenID Connect)                 |
| WAF                 | Защита от атак типа OWASP Top 10                                            | Cloudflare WAF / ModSecurity                          |
| CI/CD               | Автоматизация сборки, тестов и деплоя. Снижение TTM и человеческих ошибок   | GitLab CI/CD + Helm + Canary Deployment               |
| Observability       | Логирование, метрики, трассировка. Диагностика проблем и бизнес-мониторинг | Prometheus + Grafana + Tempo + Loki                   |
| Резервное копирование | Соответствие 152-ФЗ, восстановление после сбоев                            | PostgreSQL WAL-G + S3 Snapshots                       |

---

## 3. Рекомендуемые компоненты (SHOULD)

| Компонент           | Обоснование                                                                 | Реализация (опционально)                              |
|---------------------|------------------------------------------------------------------------------|--------------------------------------------------------|
| Service Mesh        | Управление трафиком между микросервисами (timeouts, retries, circuit breaking) | Istio                                                  |
| GeoDNS              | Маршрутизация пользователей по географической близости                      | Yandex DNS / Cloudflare DNS                           |
| Feature Flags       | Гибкое включение/отключение фич без релизов                                | LaunchDarkly / Unleash / Собственная A/B платформа                                 |

---

## 4. Схема HLD

```
          +---------------------+       +------------------+
          |     CDN / WAF      |<----->|  Web / Mobile UI |
          +---------------------+       +------------------+
                    |
          +---------+--------+
          |                  |
      +-------+        +-----------+
      | Auth  |        | Reservation|
      +-------+        +-----------+
          |                  |
          |        +-------------------+
          |        | Room Mgmt (RMS)   |
          |        +-------------------+
          |                |
      +---------+   +------------------+
      | Keycloak|   | Housekeeping     |
      +---------+   +------------------+
                    |
          +---------------------+
          | Smart Devices Svc   |
          +---------------------+
                    |
      +---------------------------+
      | Notification / Kafka Bus |
      +---------------------------+
                    |
      +--------------+-----------------------------+
      | Redis Cache  | PostgreSQL | MongoDB | S3   |
      +--------------+-----------------------------+
                    |
       +------------------------------+
       | Observability / Prometheus   |
       | Grafana / Tempo / Loki       |
       +------------------------------+

Service Mesh (Istio) и CI/CD инструменты находятся на уровне инфраструктуры
```

---

## 5. Заключение

Интеграция необходимых компонентов обеспечивает как устойчивость и надежность, так и безопасность продуктового контура, соответствие регуляторным требованиям и требованиям заказчика. Рекомендуемые компоненты повышают гибкость и быструю масштабируемость системы. Решения подобраны с учетом особенностей компании-заказчика и микросервисной архитектуры.
